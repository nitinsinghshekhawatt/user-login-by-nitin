<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SmartBus - Real-time Transport Tracker</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
            background: #f5f5f5;
            overflow-x: hidden;
        }

        /* Login Screen */
        .login-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
        }

        .login-box {
            background: white;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 400px;
        }

        .login-box h1 {
            color: #333;
            margin-bottom: 30px;
            text-align: center;
            font-size: 28px;
        }

        .role-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .role-btn {
            flex: 1;
            padding: 15px;
            border: 2px solid #ddd;
            background: white;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            font-weight: 500;
        }

        .role-btn.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .login-input {
            width: 100%;
            padding: 15px;
            margin-bottom: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
        }

        .login-btn {
            width: 100%;
            padding: 15px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: background 0.3s;
        }

        .login-btn:hover {
            background: #5a67d8;
        }

        /* Main App Container */
        .app-container {
            display: none;
            min-height: 100vh;
            position: relative;
        }

        /* Header */
        .header {
            background: #667eea;
            color: white;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .header h2 {
            font-size: 20px;
        }

        .header-controls {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .language-selector {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
        }

        .logout-btn {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
        }

        /* Location Display */
        .location-display {
            background: #f8f9ff;
            padding: 15px;
            margin: 10px 20px;
            border-radius: 10px;
            border-left: 4px solid #667eea;
            font-size: 14px;
            color: #333;
        }

        .location-coords {
            font-family: monospace;
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }

        .location-status {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 5px;
        }

        .location-active {
            background: #4caf50;
            animation: pulse 2s infinite;
        }

        .location-inactive {
            background: #f44336;
        }

        /* Passenger View */
        .passenger-view {
            display: none;
            padding-bottom: 80px;
        }

        .map-container {
            height: 400px;
            background: #e0e0e0;
            position: relative;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            color: #666;
        }

        .map-controls {
            position: absolute;
            top: 10px;
            right: 10px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .map-btn {
            width: 40px;
            height: 40px;
            background: white;
            border: none;
            border-radius: 50%;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
        }

        .bus-info-card {
            background: white;
            margin: 20px;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        }

        .eta-display {
            font-size: 36px;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 10px;
        }

        .crowd-indicator {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 15px 0;
        }

        .crowd-bar {
            flex: 1;
            height: 20px;
            background: #f0f0f0;
            border-radius: 10px;
            overflow: hidden;
        }

        .crowd-fill {
            height: 100%;
            transition: width 0.3s;
        }

        .crowd-empty { background: #4caf50; }
        .crowd-medium { background: #ff9800; }
        .crowd-full { background: #f44336; }

        .nearby-stops {
            margin: 20px;
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        }

        .stop-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid #f0f0f0;
            cursor: pointer;
            transition: background 0.3s;
        }

        .stop-item:hover {
            background: #f8f9ff;
        }

        .stop-item:last-child {
            border-bottom: none;
        }

        .stop-distance {
            color: #667eea;
            font-weight: bold;
        }

        .action-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin: 20px;
        }

        .action-btn {
            padding: 20px;
            border: none;
            border-radius: 15px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }

        .action-btn:hover {
            transform: translateY(-2px);
        }

        .sos-btn {
            background: #f44336;
            color: white;
        }

        .complaint-btn {
            background: #ff9800;
            color: white;
        }

        .save-route-btn {
            background: #4caf50;
            color: white;
        }

        .view-routes-btn {
            background: #2196f3;
            color: white;
        }

        /* Driver View */
        .driver-view {
            display: none;
            background: #1a1a1a;
            color: white;
            min-height: 100vh;
        }

        .driver-dashboard {
            padding: 20px;
        }

        .driver-map {
            height: 300px;
            background: #333;
            border-radius: 15px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: #666;
            position: relative;
        }

        .driver-location-info {
            background: #2a2a2a;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .route-progress {
            background: #333;
            height: 8px;
            border-radius: 4px;
            margin: 15px 0;
            overflow: hidden;
        }

        .route-progress-fill {
            height: 100%;
            background: #667eea;
            width: 35%;
            transition: width 0.3s;
        }

        .driver-info-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .driver-info-card {
            background: #2a2a2a;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
        }

        .driver-info-card h3 {
            font-size: 14px;
            color: #888;
            margin-bottom: 10px;
        }

        .driver-info-card .value {
            font-size: 28px;
            font-weight: bold;
            color: #667eea;
        }

        .traffic-light {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            margin: 10px auto;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: bold;
        }

        .traffic-green { background: #4caf50; }
        .traffic-yellow { background: #ffeb3b; color: #333; }
        .traffic-red { background: #f44336; }

        .driver-actions {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            padding: 20px;
        }

        .driver-action-btn {
            padding: 25px;
            border: none;
            border-radius: 15px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }

        .report-accident-btn {
            background: #f44336;
            color: white;
        }

        .road-issue-btn {
            background: #ff9800;
            color: white;
        }

        .end-trip-btn {
            background: #4caf50;
            color: white;
            grid-column: span 2;
        }

        /* Admin View */
        .admin-view {
            display: none;
            padding-bottom: 80px;
        }

        .admin-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 20px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        }

        .stat-card h3 {
            font-size: 14px;
            color: #666;
            margin-bottom: 10px;
        }

        .stat-card .value {
            font-size: 32px;
            font-weight: bold;
            color: #667eea;
        }

        .admin-map {
            height: 300px;
            background: #e0e0e0;
            margin: 20px;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            color: #666;
            position: relative;
        }

        .bus-marker {
            position: absolute;
            width: 40px;
            height: 40px;
            background: #667eea;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
            animation: bounce 2s infinite;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .complaint-list {
            margin: 20px;
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        }

        .complaint-item {
            padding: 15px;
            border-bottom: 1px solid #f0f0f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .complaint-item:last-child {
            border-bottom: none;
        }

        .complaint-type {
            font-weight: bold;
            color: #f44336;
        }

        .complaint-bus {
            color: #666;
            font-size: 14px;
        }

        .complaint-location {
            font-size: 12px;
            color: #888;
            margin-top: 5px;
        }

        /* Bottom Navigation */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            display: flex;
            justify-content: space-around;
            padding: 10px 0;
            box-shadow: 0 -5px 20px rgba(0,0,0,0.1);
            z-index: 1000;
        }

        .nav-item {
            flex: 1;
            text-align: center;
            padding: 10px;
            cursor: pointer;
            transition: all 0.3s;
            border: none;
            background: none;
            font-size: 14px;
            color: #666;
        }

        .nav-item.active {
            color: #667eea;
        }

        /* Notifications */
        .notification {
            position: fixed;
            top: 80px;
            right: 20px;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            transform: translateX(400px);
            transition: transform 0.3s;
            max-width: 300px;
            z-index: 2000;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification-title {
            font-weight: bold;
            margin-bottom: 5px;
            color: #333;
        }

        .notification-text {
            color: #666;
            font-size: 14px;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 3000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 20px;
            width: 100%;
            max-width: 400px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #666;
        }

        .file-upload {
            border: 2px dashed #ddd;
            padding: 30px;
            text-align: center;
            border-radius: 10px;
            margin: 20px 0;
            cursor: pointer;
            transition: all 0.3s;
        }

        .file-upload:hover {
            border-color: #667eea;
            background: #f8f9ff;
        }

        /* Location sharing toggle */
        .location-toggle {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 10px 0;
        }

        .toggle-switch {
            position: relative;
            width: 50px;
            height: 25px;
            background: #ccc;
            border-radius: 25px;
            cursor: pointer;
            transition: background 0.3s;
        }

        .toggle-switch.active {
            background: #667eea;
        }

        .toggle-slider {
            position: absolute;
            top: 2px;
            left: 2px;
            width: 21px;
            height: 21px;
            background: white;
            border-radius: 50%;
            transition: transform 0.3s;
        }

        .toggle-switch.active .toggle-slider {
            transform: translateX(25px);
        }

        /* Live Map Styles */
        .live-map {
            width: 100%;
            height: 100%;
            position: relative;
            background: linear-gradient(45deg, #e3f2fd 25%, transparent 25%), 
                        linear-gradient(-45deg, #e3f2fd 25%, transparent 25%), 
                        linear-gradient(45deg, transparent 75%, #e3f2fd 75%), 
                        linear-gradient(-45deg, transparent 75%, #e3f2fd 75%);
            background-size: 20px 20px;
            background-position: 0 0, 0 10px, 10px -10px, -10px 0px;
        }

        .location-marker {
            position: absolute;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            border-radius: 50%;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 100;
            border: 3px solid white;
        }

        .user-marker {
            background: #667eea;
            animation: pulse 2s infinite;
            box-shadow: 0 0 0 3px #667eea, 0 5px 20px rgba(0,0,0,0.3);
        }

        .bus-marker {
            background: #4caf50;
            animation: bounce 2s infinite;
            box-shadow: 0 0 0 3px #4caf50, 0 5px 20px rgba(0,0,0,0.3);
        }

        .accuracy-circle {
            position: absolute;
            border: 2px solid #667eea;
            border-radius: 50%;
            background: rgba(102, 126, 234, 0.1);
            pointer-events: none;
            z-index: 50;
        }

        /* Responsive */
        @media (max-width: 480px) {
            .action-buttons {
                grid-template-columns: 1fr;
            }
            
            .driver-actions {
                grid-template-columns: 1fr;
            }
            
            .driver-info-grid {
                grid-template-columns: 1fr;
            }
            
            .admin-stats {
                grid-template-columns: 1fr 1fr;
            }
        }

        /* Loading Animation */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        @keyframes pulse {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.1); opacity: 0.7; }
            100% { transform: scale(1); opacity: 1; }
        }

        /* Hidden by default */
        .hidden {
            display: none !important;
        }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div class="login-container" id="loginScreen">
        <div class="login-box">
            <h1>SmartBus Tracker</h1>
            <div class="role-selector">
                <button class="role-btn active" data-role="passenger">Passenger</button>
                <button class="role-btn" data-role="driver">Driver</button>
                <button class="role-btn" data-role="admin">Admin</button>
            </div>
            <input type="text" class="login-input" id="username" placeholder="Username">
            <input type="password" class="login-input" id="password" placeholder="Password">
            <button class="login-btn" onclick="login()">Login</button>
        </div>
    </div>

    <!-- Main App -->
    <div class="app-container" id="appContainer">
        <!-- Header -->
        <div class="header">
            <h2 id="appTitle">SmartBus</h2>
            <div class="header-controls">
                <select class="language-selector" id="languageSelector" onchange="changeLanguage()">
                    <option value="en">English</option>
                    <option value="hi">‡§π‡§ø‡§Ç‡§¶‡•Ä</option>
                    <option value="local">Local</option>
                </select>
                <button class="logout-btn" onclick="logout()">Logout</button>
            </div>
        </div>

        <!-- Passenger View -->
        <div class="passenger-view" id="passengerView">
            <!-- Location Display -->
            <div class="location-display">
                <div>
                    <span class="location-status location-active" id="locationStatus"></span>
                    <span id="locationText">Getting your location...</span>
                </div>
                <div class="location-coords" id="locationCoords"></div>
                <div class="location-toggle">
                    <span>Share Location</span>
                    <div class="toggle-switch active" id="locationToggle" onclick="toggleLocationSharing()">
                        <div class="toggle-slider"></div>
                    </div>
                </div>
            </div>

            <!-- Live Map -->
            <div class="map-container" id="passengerMap">
                <div class="map-controls">
                    <button class="map-btn" onclick="centerOnLocation()" title="Center on my location">üìç</button>
                    <button class="map-btn" onclick="zoomIn()" title="Zoom in">+</button>
                    <button class="map-btn" onclick="zoomOut()" title="Zoom out">-</button>
                </div>
            </div>
            
            <!-- Bus Info Card -->
            <div class="bus-info-card">
                <div class="eta-display" id="etaDisplay">5 min</div>
                <div style="color: #666;">Next bus arriving at Stop #123</div>
                
                <div class="crowd-indicator">
                    <span>Crowd:</span>
                    <div class="crowd-bar">
                        <div class="crowd-fill crowd-medium" style="width: 60%"></div>
                    </div>
                    <span>Medium</span>
                </div>
                
                <div style="display: flex; gap: 10px; margin-top: 15px;">
                    <span style="background: #e3f2fd; color: #1976d2; padding: 5px 10px; border-radius: 15px; font-size: 14px;">
                        Route 42A
                    </span>
                    <span style="background: #f3e5f5; color: #7b1fa2; padding: 5px 10px; border-radius: 15px; font-size: 14px;">
                        Bus #4201
                    </span>
                </div>
            </div>

            <!-- Nearby Stops -->
            <div class="nearby-stops">
                <h3 style="margin-bottom: 15px;">Nearby Bus Stops</h3>
                <div id="nearbyStopsList">
                    <div class="stop-item" onclick="selectStop(this)">
                        <div>
                            <div style="font-weight: bold;">Central Park Stop</div>
                            <div style="font-size: 12px; color: #666;">Routes: 42A, 15B, 23C</div>
                        </div>
                        <div class="stop-distance">0.5 km</div>
                    </div>
                    <div class="stop-item" onclick="selectStop(this)">
                        <div>
                            <div style="font-weight: bold;">Mall Entrance</div>
                            <div style="font-size: 12px; color: #666;">Routes: 42A, 30X</div>
                        </div>
                        <div class="stop-distance">0.8 km</div>
                    </div>
                    <div class="stop-item" onclick="selectStop(this)">
                        <div>
                            <div style="font-weight: bold;">City Hospital</div>
                            <div style="font-size: 12px; color: #666;">Routes: 15B, 45D</div>
                        </div>
                        <div class="stop-distance">1.2 km</div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="action-buttons">
                <button class="action-btn sos-btn" onclick="showSOSModal()">
                    <span style="font-size: 24px;">üö®</span>
                    <span>SOS Alert</span>
                </button>
                <button class="action-btn complaint-btn" onclick="showComplaintModal()">
                    <span style="font-size: 24px;">üìù</span>
                    <span>Complaint</span>
                </button>
                <button class="action-btn save-route-btn" onclick="saveRoute()">
                    <span style="font-size: 24px;">‚≠ê</span>
                    <span>Save Route</span>
                </button>
                <button class="action-btn view-routes-btn" onclick="viewSavedRoutes()">
                    <span style="font-size: 24px;">üìç</span>
                    <span>Saved Routes</span>
                </button>
            </div>
        </div>

        <!-- Driver View -->
        <div class="driver-view" id="driverView">
            <!-- Driver Location Info -->
            <div class="driver-location-info">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div>
                        <div style="font-size: 14px; color: #888;">Current Location</div>
                        <div id="driverLocationText">Updating...</div>
                    </div>
                    <div style="text-align: right;">
                        <div style="font-size: 14px; color: #888;">Bus #4201</div>
                        <div style="color: #667eea;">Route 42A</div>
                    </div>
                </div>
                <div class="route-progress">
                    <div class="route-progress-fill"></div>
                </div>
                <div style="display: flex; justify-content: space-between; font-size: 12px; color: #888;">
                    <span>Stop 5 of 15</span>
                    <span>Next: Central Park</span>
                </div>
            </div>

            <!-- Driver Map -->
            <div class="driver-map" id="driverMap">
                <div class="map-controls">
                    <button class="map-btn" onclick="centerOnLocation()" title="Center on bus location">üìç</button>
                    <button class="map-btn" onclick="zoomIn()" title="Zoom in">+</button>
                    <button class="map-btn" onclick="zoomOut()" title="Zoom out">-</button>
                </div>
            </div>
            
            <!-- Driver Info Grid -->
            <div class="driver-info-grid">
                <div class="driver-info-card">
                    <h3>Next Stop</h3>
                    <div class="value">2 min</div>
                </div>
                <div class="driver-info-card">
                    <h3>Passengers</h3>
                    <div class="value">32</div>
                </div>
                <div class="driver-info-card">
                    <h3>Current Speed</h3>
                    <div class="value">35 km/h</div>
                </div>
                <div class="driver-info-card">
                    <h3>Traffic Signal</h3>
                    <div class="traffic-light traffic-green">45</div>
                </div>
            </div>
            
            <!-- Driver Actions -->
            <div class="driver-actions">
                <button class="driver-action-btn report-accident-btn" onclick="reportAccident()">
                    <span style="font-size: 32px;">üöë</span>
                    <span>Report Accident</span>
                </button>
                <button class="driver-action-btn road-issue-btn" onclick="reportRoadIssue()">
                    <span style="font-size: 32px;">üöß</span>
                    <span>Road Issue</span>
                </button>
                <button class="driver-action-btn end-trip-btn" onclick="endTrip()">
                    <span style="font-size: 32px;">üèÅ</span>
                    <span>End Trip</span>
                </button>
            </div>
        </div>

        <!-- Admin View -->
        <div class="admin-view" id="adminView">
            <!-- Admin Stats -->
            <div class="admin-stats">
                <div class="stat-card">
                    <h3>Active Buses</h3>
                    <div class="value">24</div>
                </div>
                <div class="stat-card">
                    <h3>Total Passengers</h3>
                    <div class="value">1,248</div>
                </div>
                <div class="stat-card">
                    <h3>Delay Reports</h3>
                    <div class="value">3</div>
                </div>
                <div class="stat-card">
                    <h3>SOS Alerts</h3>
                    <div class="value">1</div>
                </div>
            </div>
            
            <!-- Fleet Map -->
            <div class="admin-map" id="adminMap">
                <div>üìä Real-time Bus Fleet Map</div>
                <div class="bus-marker" style="top: 30%; left: 20%;">4201</div>
                <div class="bus-marker" style="top: 60%; left: 70%;">4102</div>
                <div class="bus-marker" style="top: 45%; left: 50%;">4305</div>
                <div class="bus-marker" style="top: 20%; left: 80%;">4401</div>
            </div>
            
            <!-- Complaint List -->
            <div class="complaint-list">
                <h3 style="margin-bottom: 20px;">Recent Alerts & Complaints</h3>
                <div class="complaint-item">
                    <div>
                        <div class="complaint-type">SOS Alert</div>
                        <div class="complaint-bus">Bus #4201 - Route 42A</div>
                        <div class="complaint-location">üìç Central Park Stop (28.6139, 77.2090)</div>
                    </div>
                    <div style="color: #f44336; font-weight: bold;">2 min ago</div>
                </div>
                <div class="complaint-item">
                    <div>
                        <div class="complaint-type">Complaint</div>
                        <div class="complaint-bus">Bus #4102 - Route 15B</div>
                        <div class="complaint-location">üìç Mall Entrance (28.6150, 77.2080)</div>
                    </div>
                    <div style="color: #666; font-size: 14px;">15 min ago</div>
                </div>
                <div class="complaint-item">
                    <div>
                        <div class="complaint-type">Delay Report</div>
                        <div class="complaint-bus">Bus #4305 - Route 23C</div>
                        <div class="complaint-location">üìç City Hospital (28.6120, 77.2100)</div>
                    </div>
                    <div style="color: #666; font-size: 14px;">25 min ago</div>
                </div>
            </div>
        </div>

        <!-- Bottom Navigation -->
        <div class="bottom-nav">
            <button class="nav-item active" onclick="showView('home')">
                <div style="font-size: 24px;">üè†</div>
                <div>Home</div>
            </button>
            <button class="nav-item" onclick="showView('map')">
                <div style="font-size: 24px;">üó∫Ô∏è</div>
                <div>Map</div>
            </button>
            <button class="nav-item" onclick="showView('alerts')">
                <div style="font-size: 24px;">üîî</div>
                <div>Alerts</div>
            </button>
            <button class="nav-item" onclick="showView('profile')">
                <div style="font-size: 24px;">üë§</div>
                <div>Profile</div>
            </button>
        </div>
    </div>

    <!-- SOS Modal -->
    <div class="modal" id="sosModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>SOS Emergency Alert</h3>
                <button class="modal-close" onclick="closeModal('sosModal')">√ó</button>
            </div>
            <p style="margin: 20px 0; color: #666;">
                Your emergency alert will be sent to the admin with your current location:
            </p>
            <div style="background: #f8f9ff; padding: 15px; border-radius: 10px; margin: 15px 0;">
                <div id="sosLocation">Getting location...</div>
            </div>
            <div style="display: flex; gap: 10px;">
                <button class="login-btn" style="background: #f44336;" onclick="sendSOS()">Send SOS</button>
                <button class="login-btn" style="background: #666;" onclick="closeModal('sosModal')">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Complaint Modal -->
    <div class="modal" id="complaintModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>File a Complaint</h3>
                <button class="modal-close" onclick="closeModal('complaintModal')">√ó</button>
            </div>
            <textarea class="login-input" rows="4" placeholder="Describe your complaint..."></textarea>
            <div class="file-upload">
                <div style="font-size: 32px; margin-bottom: 10px;">üì∑</div>
                <div>Tap to add photo or audio</div>
            </div>
            <div style="background: #f8f9ff; padding: 15px; border-radius: 10px; margin: 15px 0;">
                <div style="font-size: 14px; color: #666;">Location will be attached automatically</div>
                <div id="complaintLocation" style="font-size: 12px; color: #888;">Getting location...</div>
            </div>
            <button class="login-btn" onclick="submitComplaint()">Submit Complaint</button>
        </div>
    </div>

    <!-- Notification -->
    <div class="notification" id="notification">
        <div class="notification-title" id="notificationTitle">Bus Alert</div>
        <div class="notification-text" id="notificationText">Your bus is arriving in 5 minutes</div>
    </div>

    <script>
        // ===== LIVE LOCATION TRACKING SYSTEM =====
        class LiveLocationTracker {
            constructor() {
                this.watchId = null;
                this.currentPosition = null;
                this.previousPosition = null;
                this.map = null;
                this.userMarker = null;
                this.busMarkers = new Map();
                this.routePolyline = null;
                this.isTracking = false;
                this.updateInterval = 3000;
                this.role = 'passenger';
                this.busLocation = { lat: 28.6139, lng: 77.2090 };
            }

            init(role) {
                this.role = role;
                this.setupMap();
                this.startLocationTracking();
                this.simulateBusTracking();
            }

            setupMap() {
                const mapContainers = {
                    passenger: 'passengerMap',
                    driver: 'driverMap',
                    admin: 'adminMap'
                };

                const containerId = mapContainers[this.role];
                if (containerId) {
                    const container = document.getElementById(containerId);
                    if (container && !container.querySelector('.live-map')) {
                        const mapElement = document.createElement('div');
                        mapElement.className = 'live-map';
                        
                        const gridOverlay = document.createElement('div');
                        gridOverlay.style.cssText = `
                            position: absolute;
                            top: 0;
                            left: 0;
                            right: 0;
                            bottom: 0;
                            background-image: 
                                linear-gradient(rgba(0,0,0,0.1) 1px, transparent 1px),
                                linear-gradient(90deg, rgba(0,0,0,0.1) 1px, transparent 1px);
                            background-size: 50px 50px;
                        `;
                        mapElement.appendChild(gridOverlay);
                        
                        this.addRoadsToMap(mapElement);
                        container.appendChild(mapElement);
                    }
                }
            }

            addRoadsToMap(mapElement) {
                const roads = [
                    { x: 10, y: 50, width: 80, height: 4, color: '#666' },
                    { x: 50, y: 10, width: 4, height: 80, color: '#666' },
                    { x: 20, y: 20, width: 60, height: 3, color: '#999', angle: 45 },
                    { x: 20, y: 70, width: 60, height: 3, color: '#999', angle: -45 }
                ];

                roads.forEach(road => {
                    const roadElement = document.createElement('div');
                    roadElement.style.cssText = `
                        position: absolute;
                        left: ${road.x}%;
                        top: ${road.y}%;
                        width: ${road.width}%;
                        height: ${road.height}%;
                        background: ${road.color};
                        ${road.angle ? `transform: rotate(${road.angle}deg);` : ''}
                        border-radius: 2px;
                    `;
                    mapElement.appendChild(roadElement);
                });
            }

            startLocationTracking() {
                if (navigator.geolocation) {
                    this.isTracking = true;
                    
                    this.watchId = navigator.geolocation.watchPosition(
                        (position) => {
                            this.previousPosition = this.currentPosition;
                            this.currentPosition = {
                                lat: position.coords.latitude,
                                lng: position.coords.longitude,
                                accuracy: position.coords.accuracy,
                                timestamp: position.timestamp
                            };
                            
                            this.updateLocationDisplay();
                            this.updateMap();
                            this.calculateSpeed();
                            this.detectMovement();
                            this.updateRoleSpecificFeatures();
                        },
                        (error) => {
                            this.handleLocationError(error);
                        },
                        {
                            enableHighAccuracy: true,
                            timeout: 5000,
                            maximumAge: 0
                        }
                    );

                    this.startBackgroundTracking();
                } else {
                    this.showError('Geolocation is not supported by this browser');
                }
            }

            startBackgroundTracking() {
                setInterval(() => {
                    if (this.isTracking && this.currentPosition) {
                        this.simulateLocationUpdate();
                    }
                }, this.updateInterval);
            }

            simulateLocationUpdate() {
                if (this.currentPosition) {
                    const noise = 0.0001;
                    this.currentPosition.lat += (Math.random() - 0.5) * noise;
                    this.currentPosition.lng += (Math.random() - 0.5) * noise;
                    
                    this.updateMap();
                    this.updateLocationDisplay();
                }
            }

            updateLocationDisplay() {
                if (!this.currentPosition) return;

                const coordElements = {
                    passenger: document.getElementById('locationCoords'),
                    driver: document.getElementById('driverLocationText')
                };

                const coordElement = coordElements[this.role];
                if (coordElement) {
                    coordElement.textContent = `Lat: ${this.currentPosition.lat.toFixed(6)}, Lng: ${this.currentPosition.lng.toFixed(6)}`;
                }

                const sosLocation = document.getElementById('sosLocation');
                if (sosLocation) {
                    sosLocation.textContent = `Lat: ${this.currentPosition.lat.toFixed(6)}, Lng: ${this.currentPosition.lng.toFixed(6)}`;
                }

                const complaintLocation = document.getElementById('complaintLocation');
                if (complaintLocation) {
                    complaintLocation.textContent = `Lat: ${this.currentPosition.lat.toFixed(6)}, Lng: ${this.currentPosition.lng.toFixed(6)}`;
                }
            }

            updateMap() {
                if (!this.currentPosition) return;

                const mapElement = document.querySelector('.live-map');
                if (!mapElement) return;

                if (!this.userMarker) {
                    this.userMarker = this.createMarker('user', this.currentPosition, 'üìç');
                    mapElement.appendChild(this.userMarker);
                } else {
                    this.updateMarkerPosition(this.userMarker, this.currentPosition);
                }

                this.updateAccuracyCircle();
            }

            createMarker(type, position, icon) {
                const marker = document.createElement('div');
                marker.className = `location-marker ${type}-marker`;
                marker.innerHTML = icon;
                marker.style.cssText = `
                    position: absolute;
                    width: 40px;
                    height: 40px;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    font-size: 24px;
                    background: ${type === 'user' ? '#667eea' : type === 'bus' ? '#4caf50' : '#ff9800'};
                    border-radius: 50%;
                    box-shadow: 0 2px 10px rgba(0,0,0,0.3);
                    cursor: pointer;
                    transition: all 0.3s ease;
                    z-index: 100;
                    border: 3px solid white;
                    animation: ${type === 'bus' ? 'bounce 2s infinite' : 'pulse 2s infinite'};
                `;

                marker.addEventListener('click', () => {
                    this.showMarkerDetails(type, position);
                });

                this.updateMarkerPosition(marker, position);
                return marker;
            }

            updateMarkerPosition(marker, position) {
                const x = this.lngToX(position.lng);
                const y = this.latToY(position.lat);
                
                marker.style.left = `${x}%`;
                marker.style.top = `${y}%`;
            }

            lngToX(lng) {
                const centerLng = 77.2090;
                const scale = 0.1;
                return 50 + (lng - centerLng) * scale * 100;
            }

            latToY(lat) {
                const centerLat = 28.6139;
                const scale = 0.1;
                return 50 - (lat - centerLat) * scale * 100;
            }

            showMarkerDetails(type, position) {
                const details = {
                    user: `Your Location\nLat: ${position.lat.toFixed(6)}\nLng: ${position.lng.toFixed(6)}\nAccuracy: ${position.accuracy || 'N/A'}m`,
                    bus: `Bus Location\nLat: ${position.lat.toFixed(6)}\nLng: ${position.lng.toFixed(6)}\nSpeed: ${position.speed || 'N/A'} km/h`
                };

                showNotification('Location Details', details[type] || 'Unknown location');
            }

            updateAccuracyCircle() {
                if (!this.currentPosition?.accuracy) return;

                let accuracyCircle = document.querySelector('.accuracy-circle');
                if (!accuracyCircle) {
                    accuracyCircle = document.createElement('div');
                    accuracyCircle.className = 'accuracy-circle';
                    document.querySelector('.live-map').appendChild(accuracyCircle);
                }

                const accuracy = this.currentPosition.accuracy;
                const size = Math.max(20, accuracy * 0.1);
                const x = this.lngToX(this.currentPosition.lng);
                const y = this.latToY(this.currentPosition.lat);

                accuracyCircle.style.left = `${x}%`;
                accuracyCircle.style.top = `${y}%`;
                accuracyCircle.style.width = `${size}px`;
                accuracyCircle.style.height = `${size}px`;
                accuracyCircle.style.transform = 'translate(-50%, -50%)';
            }

            calculateDistance(lat1, lng1, lat2, lng2) {
                const R = 6371000;
                const dLat = (lat2 - lat1) * Math.PI / 180;
                const dLng = (lng2 - lng1) * Math.PI / 180;
                const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                          Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                          Math.sin(dLng/2) * Math.sin(dLng/2);
                const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
                return R * c;
            }

            detectMovement() {
                if (!this.previousPosition || !this.currentPosition) return;

                const distance = this.calculateDistance(
                    this.previousPosition.lat,
                    this.previousPosition.lng,
                    this.currentPosition.lat,
                    this.currentPosition.lng
                );

                if (distance > 10) {
                    this.onMovementDetected(distance);
                }
            }

            onMovementDetected(distance) {
                const statusElement = document.getElementById('locationText');
                if (statusElement) {
                    statusElement.textContent = `Moving (${distance.toFixed(0)}m)`;
                }

                if (this.role === 'passenger') {
                    this.updateNearbyStops();
                } else if (this.role === 'driver') {
                    this.updateRouteProgress();
                }

                if (distance > 50 && navigator.vibrate) {
                    navigator.vibrate(100);
                }
            }

            updateNearbyStops() {
                if (!this.currentPosition) return;

                const stops = [
                    { name: 'Central Park Stop', lat: 28.6139, lng: 77.2090, routes: ['42A', '15B', '23C'] },
                    { name: 'Mall Entrance', lat: 28.6150, lng: 77.2080, routes: ['42A', '30X'] },
                    { name: 'City Hospital', lat: 28.6120, lng: 77.2100, routes: ['15B', '45D'] }
                ];

                stops.forEach(stop => {
                    stop.distance = this.calculateDistance(
                        this.currentPosition.lat,
                        this.currentPosition.lng,
                        stop.lat,
                        stop.lng
                    ) / 1000;
                });

                this.displayNearbyStops(stops);
            }

            displayNearbyStops(stops) {
                const stopsList = document.getElementById('nearbyStopsList');
                if (!stopsList) return;

                stops.sort((a, b) => a.distance - b.distance);
                
                stopsList.innerHTML = stops.map(stop => `
                    <div class="stop-item" onclick="selectStop(this)" data-lat="${stop.lat}" data-lng="${stop.lng}">
                        <div>
                            <div style="font-weight: bold;">${stop.name}</div>
                            <div style="font-size: 12px; color: #666;">Routes: ${stop.routes.join(', ')}</div>
                        </div>
                        <div class="stop-distance">${stop.distance.toFixed(1)} km</div>
                    </div>
                `).join('');
            }

            simulateBusTracking() {
                const busData = [
                    { id: '4201', lat: 28.6139, lng: 77.2090, route: '42A' },
                    { id: '4102', lat: 28.6150, lng: 77.2080, route: '15B' },
                    { id: '4305', lat: 28.6120, lng: 77.2100, route: '23C' },
                    { id: '4401', lat: 28.6140, lng: 77.2070, route: '30X' }
                ];

                busData.forEach(bus => {
                    this.createBusMarker(bus);
                });

                setInterval(() => {
                    busData.forEach(bus => {
                        bus.lat += (Math.random() - 0.5) * 0.0005;
                        bus.lng += (Math.random() - 0.5) * 0.0005;
                        this.updateBusMarker(bus);
                    });
                }, 5000);
            }

            createBusMarker(busData) {
                const mapElement = document.querySelector('.live-map');
                if (!mapElement) return;

                const marker = this.createMarker('bus', busData, 'üöå');
                marker.setAttribute('data-bus-id', busData.id);
                marker.setAttribute('data-route', busData.route);
                
                const busId = document.createElement('div');
                busId.style.cssText = `
                    position: absolute;
                    top: -5px;
                    right: -5px;
                    background: #333;
                    color: white;
                    font-size: 10px;
                    padding: 2px 5px;
                    border-radius: 3px;
                    font-weight: bold;
                `;
                busId.textContent = busData.id;
                marker.appendChild(busId);

                mapElement.appendChild(marker);
                this.busMarkers.set(busData.id, marker);
            }

            updateBusMarker(busData) {
                const marker = this.busMarkers.get(busData.id);
                if (marker) {
                    this.updateMarkerPosition(marker, busData);
                }
            }

            updateRoleSpecificFeatures() {
                switch(this.role) {
                    case 'passenger':
                        this.updatePassengerFeatures();
                        break;
                    case 'driver':
                        this.updateDriverFeatures();
                        break;
                    case 'admin':
                        this.updateAdminFeatures();
                        break;
                }
            }

            updatePassengerFeatures() {
                this.updateETA();
                this.checkNearbyBuses();
                this.updateWalkingDirections();
            }

            updateDriverFeatures() {
                this.updateRouteProgress();
                this.checkTrafficConditions();
                this.updateNextStopETA();
            }

            updateAdminFeatures() {
                this.updateFleetPositions();
                this.monitorBusSpeeds();
                this.updateHeatmap();
            }

            updateETA() {
                if (!this.currentPosition) return;

                const etaDisplay = document.getElementById('etaDisplay');
                if (etaDisplay) {
                    const currentETA = parseInt(etaDisplay.textContent);
                    const newETA = Math.max(1, currentETA - 1);
                    etaDisplay.textContent = `${newETA} min`;
                }
            }

            checkNearbyBuses() {
                const buses = Array.from(this.busMarkers.values());
                buses.forEach(bus => {
                    const busLat = parseFloat(bus.style.left) / 100 * 0.1 + 28.6139;
                    const busLng = parseFloat(bus.style.top) / 100 * 0.1 + 77.2090;
                    
                    const distance = this.calculateDistance(
                        this.currentPosition.lat,
                        this.currentPosition.lng,
                        busLat,
                        busLng
                    );
                    
                    if (distance < 200) {
                        const busId = bus.getAttribute('data-bus-id');
                        showNotification('Bus Nearby', `Bus ${busId} is very close!`);
                    }
                });
            }

            updateWalkingDirections() {
                if (!this.currentPosition) return;
                
                const nearestStop = this.findNearestStop();
                if (nearestStop) {
                    const distance = this.calculateDistance(
                        this.currentPosition.lat,
                        this.currentPosition.lng,
                        nearestStop.lat,
                        nearestStop.lng
                    );
                    
                    const walkingTime = Math.round((distance / 1000) / 5 * 60);
                    
                    const walkingElement = document.getElementById('walkingTime');
                    if (walkingElement) {
                        walkingElement.textContent = `${walkingTime} min walk`;
                    }
                }
            }

            findNearestStop() {
                const stops = [
                    { name: 'Central Park Stop', lat: 28.6139, lng: 77.2090 },
                    { name: 'Mall Entrance', lat: 28.6150, lng: 77.2080 },
                    { name: 'City Hospital', lat: 28.6120, lng: 77.2100 }
                ];
                
                let nearest = null;
                let minDistance = Infinity;
                
                stops.forEach(stop => {
                    const distance = this.calculateDistance(
                        this.currentPosition.lat,
                        this.currentPosition.lng,
                        stop.lat,
                        stop.lng
                    );
                    
                    if (distance < minDistance) {
                        minDistance = distance;
                        nearest = stop;
                    }
                });
                
                return nearest;
            }

            updateRouteProgress() {
                if (!this.currentPosition) return;

                const progressBar = document.querySelector('.route-progress-fill');
                if (progressBar) {
                    const currentProgress = parseFloat(progressBar.style.width) || 35;
                    const newProgress = Math.min(100, currentProgress + Math.random() * 2);
                    progressBar.style.width = `${newProgress}%`;
                }
            }

            checkTrafficConditions() {
                const hour = new Date().getHours();
                const isPeakHour = (hour >= 8 && hour <= 10) || (hour >= 17 && hour <= 19);
                
                const trafficLight = document.querySelector('.traffic-light');
                if (trafficLight) {
                    if (isPeakHour) {
                        trafficLight.className = 'traffic-light traffic-red';
                        trafficLight.textContent = 'Slow';
                    } else {
                        trafficLight.className = 'traffic-light traffic-green';
                        trafficLight.textContent = '45';
                    }
                }
            }

            updateNextStopETA() {
                if (!this.currentPosition) return;
                
                const nextStopDistance = 500 + Math.random() * 1000;
                const avgSpeed = 25;
                const etaMinutes = Math.round((nextStopDistance / 1000) / avgSpeed * 60);
                
                const nextStopElement = document.querySelector('.driver-info-card .value');
                if (nextStopElement && nextStopElement.previousElementSibling.textContent === 'Next Stop') {
                    nextStopElement.textContent = `${etaMinutes} min`;
                }
            }

            updateFleetPositions() {
                this.busMarkers.forEach((marker, busId) => {
                    const currentTop = parseFloat(marker.style.top) || 50;
                    const currentLeft = parseFloat(marker.style.left) || 50;
                    
                    const newTop = Math.max(10, Math.min(80, currentTop + (Math.random() - 0.5) * 5));
                    const newLeft = Math.max(10, Math.min(80, currentLeft + (Math.random() - 0.5) * 5));
                    
                    marker.style.top = `${newTop}%`;
                    marker.style.left = `${newLeft}%`;
                });
            }

            monitorBusSpeeds() {
                this.busMarkers.forEach((marker, busId) => {
                    const speed = 20 + Math.random() * 40;
                    
                    if (speed > 50) {
                        marker.style.background = '#f44336';
                    } else if (speed > 30) {
                        marker.style.background = '#ff9800';
                    } else {
                        marker.style.background = '#4caf50';
                    }
                });
            }

            updateHeatmap() {
                const heatmapData = [];
                for (let i = 0; i < 10; i++) {
                    heatmapData.push({
                        lat: 28.6139 + (Math.random() - 0.5) * 0.01,
                        lng: 77.2090 + (Math.random() - 0.5) * 0.01,
                        intensity: Math.random()
                    });
                }
                
                this.displayHeatmap(heatmapData);
            }

            displayHeatmap(data) {
                const oldHeatmap = document.querySelector('.heatmap-layer');
                if (oldHeatmap) {
                    oldHeatmap.remove();
                }
                
                const mapElement = document.querySelector('.live-map');
                if (!mapElement) return;
                
                const heatmapLayer = document.createElement('div');
                heatmapLayer.className = 'heatmap-layer';
                heatmapLayer.style.cssText = `
                    position: absolute;
                    top: 0;
                    left: 0;
                    right: 0;
                    bottom: 0;
                    pointer-events: none;
                `;
                
                data.forEach(point => {
                    const heatPoint = document.createElement('div');
                    heatPoint.style.cssText = `
                        position: absolute;
                        left: ${this.lngToX(point.lng)}%;
                        top: ${this.latToY(point.lat)}%;
                        width: 30px;
                        height: 30px;
                        background: radial-gradient(circle, rgba(255,0,0,${point.intensity}) 0%, transparent 70%);
                        border-radius: 50%;
                        transform: translate(-50%, -50%);
                    `;
                    heatmapLayer.appendChild(heatPoint);
                });
                
                mapElement.appendChild(heatmapLayer);
            }

            calculateSpeed() {
                if (!this.previousPosition || !this.currentPosition) return;

                const timeDiff = this.currentPosition.timestamp - this.previousPosition.timestamp;
                const distance = this.calculateDistance(
                    this.previousPosition.lat,
                    this.previousPosition.lng,
                    this.currentPosition.lat,
                    this.currentPosition.lng
                );

                if (timeDiff > 0) {
                    const speed = (distance / (timeDiff / 1000)) * 3.6;
                    this.currentPosition.speed = speed;
                    
                    if (this.role === 'driver') {
                        const speedElement = document.querySelector('.driver-info-card .value');
                        if (speedElement && speedElement.previousElementSibling.textContent === 'Current Speed') {
                            speedElement.textContent = `${Math.round(speed)} km/h`;
                        }
                    }
                }
            }

            handleLocationError(error) {
                let message = '';
                switch(error.code) {
                    case error.PERMISSION_DENIED:
                        message = 'Location access denied by user';
                        break;
                    case error.POSITION_UNAVAILABLE:
                        message = 'Location information unavailable';
                        break;
                    case error.TIMEOUT:
                        message = 'Location request timed out';
                        break;
                    default:
                        message = 'Unknown location error';
                }
                
                showNotification('Location Error', message);
            }
        }

        // ===== GLOBAL VARIABLES =====
        let currentRole = 'passenger';
        let currentView = 'home';
        let locationTracker = null;
        let etaInterval = null;
        let notificationInterval = null;

        // ===== LOGIN & ROLE MANAGEMENT =====
        function login() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            if (!username || !password) {
                alert('Please enter username and password');
                return;
            }

            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('appContainer').style.display = 'block';
            
            if (currentRole === 'passenger') {
                document.getElementById('passengerView').style.display = 'block';
                document.getElementById('appTitle').textContent = 'Passenger Dashboard';
                startPassengerFeatures();
            } else if (currentRole === 'driver') {
                document.getElementById('driverView').style.display = 'block';
                document.getElementById('appTitle').textContent = 'Driver Dashboard';
                startDriverFeatures();
            } else if (currentRole === 'admin') {
                document.getElementById('adminView').style.display = 'block';
                document.getElementById('appTitle').textContent = 'Admin Dashboard';
                startAdminFeatures();
            }

            showNotification('Login Successful', `Welcome ${username}!`);
            
            // Initialize location tracking
            setTimeout(() => {
                initializeLocationTracking(currentRole);
            }, 1000);
        }

        function logout() {
            document.getElementById('loginScreen').style.display = 'flex';
            document.getElementById('appContainer').style.display = 'none';
            document.getElementById('passengerView').style.display = 'none';
            document.getElementById('driverView').style.display = 'none';
            document.getElementById('adminView').style.display = 'none';
            
            if (etaInterval) clearInterval(etaInterval);
            if (notificationInterval) clearInterval(notificationInterval);
            if (locationTracker) {
                locationTracker.stopTracking();
            }
        }

        function changeLanguage() {
            const lang = document.getElementById('languageSelector').value;
            showNotification('Language Changed', `Language set to ${lang === 'en' ? 'English' : lang === 'hi' ? 'Hindi' : 'Local'}`);
        }

        // ===== LOCATION TRACKING =====
        function initializeLocationTracking(role) {
            if (!locationTracker) {
                locationTracker = new LiveLocationTracker();
            }
            locationTracker.init(role);
        }

        function toggleLocationSharing() {
            const toggle = document.getElementById('locationToggle');
            const locationDisplay = document.querySelector('.location-display');
            
            if (toggle.classList.contains('active')) {
                toggle.classList.remove('active');
                if (locationTracker) {
                    locationTracker.stopTracking();
                }
                locationDisplay.style.opacity = '0.5';
                showNotification('Location Sharing', 'Location sharing disabled');
            } else {
                toggle.classList.add('active');
                if (locationTracker) {
                    locationTracker.startLocationTracking();
                }
                locationDisplay.style.opacity = '1';
                showNotification('Location Sharing', 'Location sharing enabled');
            }
        }

        function centerOnLocation() {
            if (locationTracker && locationTracker.getCurrentLocation()) {
                showNotification('Map Centered', 'Map centered on your location');
            } else {
                showNotification('Location Error', 'Unable to get your location');
            }
        }

        function zoomIn() {
            showNotification('Zoom', 'Zooming in');
        }

        function zoomOut() {
            showNotification('Zoom', 'Zooming out');
        }

        function selectStop(element) {
            document.querySelectorAll('.stop-item').forEach(item => {
                item.style.background = '';
            });
            element.style.background = '#f8f9ff';
            
            const stopName = element.querySelector('div > div').textContent;
            showNotification('Stop Selected', `Selected ${stopName}`);
        }

        // ===== PASSENGER FEATURES =====
        function startPassengerFeatures() {
            etaInterval = setInterval(() => {
                if (locationTracker) locationTracker.updateETA();
            }, 30000);
            
            setTimeout(() => {
                showNotification('Bus Departure', 'Bus #4201 has left the previous stop');
                if (navigator.vibrate) {
                    navigator.vibrate([200, 100, 200]);
                }
            }, 10000);
        }

        // ===== DRIVER FEATURES =====
        function startDriverFeatures() {
            setInterval(() => {
                const trafficLight = document.querySelector('.traffic-light');
                const lights = ['traffic-green', 'traffic-yellow', 'traffic-red'];
                const timers = ['45', '5', '30'];
                const randomIndex = Math.floor(Math.random() * 3);
                
                trafficLight.className = `traffic-light ${lights[randomIndex]}`;
                trafficLight.textContent = timers[randomIndex];
            }, 15000);

            setTimeout(() => {
                showNotification('Hazard Alert', 'Traffic jam reported ahead at your location');
                if (navigator.vibrate) {
                    navigator.vibrate([500, 200, 500]);
                }
            }, 20000);
        }

        // ===== ADMIN FEATURES =====
        function startAdminFeatures() {
            setInterval(() => {
                const statValues = document.querySelectorAll('.stat-card .value');
                statValues[0].textContent = Math.floor(Math.random() * 30) + 20;
                statValues[1].textContent = Math.floor(Math.random() * 2000) + 1000;
            }, 10000);
        }

        // ===== MODAL FUNCTIONS =====
        function showSOSModal() {
            document.getElementById('sosModal').classList.add('show');
        }

        function showComplaintModal() {
            document.getElementById('complaintModal').classList.add('show');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('show');
        }

        function sendSOS() {
            closeModal('sosModal');
            showNotification('SOS Sent', 'Emergency alert has been sent to admin with your location');
            
            setTimeout(() => {
                if (currentRole === 'admin') {
                    showNotification('SOS Alert', 'New SOS from Bus #4201 at your location');
                }
            }, 2000);
        }

        function submitComplaint() {
            closeModal('complaintModal');
            showNotification('Complaint Filed', 'Your complaint has been submitted successfully with location data');
        }

        // ===== ACTION FUNCTIONS =====
        function saveRoute() {
            showNotification('Route Saved', 'Route 42A has been saved to your favorites');
        }

        function viewSavedRoutes() {
            showNotification('Saved Routes', 'You have 3 saved routes');
        }

        function reportAccident() {
            const locationText = locationTracker && locationTracker.getCurrentLocation() ? 
                `Lat: ${locationTracker.getCurrentLocation().lat.toFixed(6)}, Lng: ${locationTracker.getCurrentLocation().lng.toFixed(6)}` : 
                'Location unavailable';
            
            showNotification('Accident Reported', `Admin has been notified about the accident at ${locationText}`);
        }

        function reportRoadIssue() {
            showNotification('Road Issue Reported', 'Thank you for reporting the road issue with location');
        }

        function endTrip() {
            if (confirm('Are you sure you want to end the trip?')) {
                showNotification('Trip Ended', 'Your trip has been completed successfully');
            }
        }

        // ===== NAVIGATION =====
        function showView(view) {
            currentView = view;
            
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            event.target.closest('.nav-item').classList.add('active');
            
            if (view === 'map') {
                showNotification('Map View', 'Opening map with real-time locations');
            } else if (view === 'alerts') {
                showNotification('Alerts', 'You have 3 new alerts');
            } else if (view === 'profile') {
                showNotification('Profile', 'Profile feature coming soon');
            }
        }

        // ===== NOTIFICATIONS =====
        function showNotification(title, text) {
            const notification = document.getElementById('notification');
            document.getElementById('notificationTitle').textContent = title;
            document.getElementById('notificationText').textContent = text;
            
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // ===== INITIALIZATION =====
        document.addEventListener('DOMContentLoaded', function() {
            // Role selection
            document.querySelectorAll('.role-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.role-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    currentRole = this.dataset.role;
                });
            });
        });
    </script>
</body>
</html>
